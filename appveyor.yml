environment:
  matrix:
    - PYTHON: "C:/Python27"
  global:
    MYSQL_PWD: Password12!
    POSTGRES_PORT: tcp://localhost:5432
    PGUSER: postgres
    PGPASSWORD: Password12!
    ONLYINSTALL: yes

services:
  - mongodb
  - mysql
  - postgresql

install:
  - "set PATH=%PYTHON%;%PYTHON%/Scripts;%PATH%"

  - "python.exe setup.py develop"
  - "pip.exe install psycopg2 mysqlclient codecov"
  - "pip.exe install pytest pytest-cov pytest-django pytest-pythonpath"
  - "pip.exe install flask-sqlalchemy==2.1 mock==2.0.0 responses==0.5.1"

build: false

before_test:
  - "set PATH=C:/Program Files/MySql/MySQL Server 5.7/bin;%PATH%"
  - "set PATH=C:/Program Files/PostgreSQL/9.5/bin;%PATH%"

  - "mysql -u root -e \"CREATE USER cuckoo@localhost IDENTIFIED BY 'cuckoo'\""
  - "mysql -u root -e \"GRANT ALL PRIVILEGES ON * . * TO cuckoo@localhost\""
  - "mysql -u root -e \"FLUSH PRIVILEGES\""
  - "mysql -u root -e \"CREATE DATABASE cuckootest\""
  - "mysql -u root -e \"CREATE DATABASE cuckootest060\""
  - "psql -c \"CREATE USER cuckoo WITH PASSWORD 'cuckoo'\""
  - "psql -c \"CREATE DATABASE cuckootest\""
  - "psql -c \"CREATE DATABASE cuckootest060\""

test_script:
  - "cuckoo.exe -d"
  - "cuckoo.exe community"
  - "pytest.exe --cov=cuckoo"

after_test:
  - "codecov.exe"
