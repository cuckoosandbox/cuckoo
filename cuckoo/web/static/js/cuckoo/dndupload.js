"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),DndUpload=function(){function e(t,s,r){_classCallCheck(this,e),this.endpoint=s,this._success_callback=r,this._selectors={uid:"dndupload_"+e.generateUUID(),target:t},this._bound=!1}return _createClass(e,[{key:"draw",value:function(){$(this._selectors.target).empty();var e='\n            <div class="dndupload" id="'+this._selectors.uid+'">\n                <form id="uploader" action="/submit/api/presubmit" method="POST" enctype="multipart/form-data">\n                    <div id="container">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43">\n                            <path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"/>\n                        </svg>\n    \n                        <input type="file" name="files[]" id="file" class="holder_input" data-multiple-caption="{count} files selected" multiple="">\n                        <label for="file" id="info">\n                            <strong>Choose files</strong>\n                            <span class="box__dragndrop"> or drag them here</span>.\n                        </label>\n    \n                        <button type="submit" class="holder_button">Upload</button>\n    \n                        <progress id="uploadprogress" min="0" max="100" value="0">0</progress>\n                    </div>\n                </form>\n            </div>\n\n            <p id="filereader">File API &amp; FileReader API not supported</p>\n            <p id="formdata">XHR2\'s FormData is not supported</p>\n            <p id="progress">XHR2\'s upload progress isn\'t supported</p>\n        ';$(this._selectors.target).append(e),this._bound||this._bind()}},{key:"_bind",value:function(){var e=this,t=document.querySelector("div#"+e._selectors.uid);e._selectors.holder=t,e._selectors.progress=document.querySelector(e._selectors.target).querySelector("progress#uploadprogress"),e._selectors.upload=t.querySelector("upload"),e._selectors.form=t.querySelector("form#uploader"),e._selectors.tests={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest},e._selectors.support={filereader:document.getElementById("filereader"),formdata:document.getElementById("formdata"),progress:document.getElementById("progress")},"filereader formdata progress".split(" ").forEach(function(t){e._selectors.tests[t]===!1?e._selectors.support[t].className="fail":e._selectors.support[t].className="hidden"}),e._selectors.holder.querySelector('input[type="file"]').addEventListener("change",function(t){var s=document.createEvent("HTMLEvents");s.initEvent("submit",!0,!1),e._selectors.form.dispatchEvent(s)}),e._selectors.form.addEventListener("submit",function(e){e.preventDefault(),this._process_files()}.bind(this)),e._selectors.tests.dnd?(t.querySelector("form#uploader").ondragover=function(){return this.className="hover",!1},t.querySelector("form#uploader").ondragend=function(){return this.className="",!1},["dragleave","dragend","drop"].forEach(function(e){t.querySelector("form#uploader").addEventListener(e,function(){this.classList.remove("hover")})}),t.querySelector("form#uploader").ondrop=function(t){this.className="",t.preventDefault(),e._process_files(t.dataTransfer.files)}):(this._selectors.upload.className="hidden",this._selectors.upload.querySelector("input").onchange=function(){e._process_files(this.files)}),this._bound=!0}},{key:"_process_files",value:function(e){var t=this,s=new FormData;if(t._selectors.holder.querySelector('input[type="file"]').files&&!e)s=new FormData(t._selectors.form);else for(var r=0;r<e.length;r++)s.append("files[]",e[r]);s&&this._upload(s)}},{key:"_upload",value:function(e){var t=this,s=new XMLHttpRequest;this.display_text("Uploading"),e.type="files",s.open("POST",this.endpoint),s.onload=function(){t._selectors.progress.value=t._selectors.progress.innerHTML=100},s.onreadystatechange=function(){4===s.readyState&&(200==s.status?(t.display_text("Done"),setTimeout(function(){t._success_callback(s)},600)):0==s.status||t.display_text("Error: http.status = "+s.status+" OR response.status not OK"))},this._selectors.tests.progress&&(s.upload.onprogress=function(e){if(e.lengthComputable){var s=e.loaded/e.total*100|0;t._selectors.progress.value=t._selectors.progress.innerHTML=s}}),s.send(e)}},{key:"display_text",value:function(e){var t=$(this._selectors.form.querySelector("label#info"));t.html(e)}}],[{key:"generateUUID",value:function(){return(new Date).getTime()}}]),e}();
//# sourceMappingURL=dndupload.js.map
