"use strict";function _classCallCheck(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function s(s,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}return function(t,a,e){return a&&s(t.prototype,a),e&&s(t,e),t}}(),Recent=function(){function s(){_classCallCheck(this,s),this.loading=!1,this.loader=new Loader($(".loading")),this.limit=100,this.offset=0,this.empty_results=!1,this.params={cats:[],packs:[],score:""}}return _createClass(s,[{key:"toggle_loading",value:function(){this.loader.loading?this.loader.stop():this.loader.start()}},{key:"gather_params",value:function(){function s(s){return $("div.nav_container>div a[data-filter="+s+"]").parent().hasClass("active")}return $("div#no_more_results").hide(),s("cat_files")&&this.params.cats.push("file"),s("cat_urls")&&this.params.cats.push("url"),s("score_0-4")?this.params.score="0-4":s("score_4-7")?this.params.score="4-7":s("score_7-10")&&(this.params.score="7-10"),this.params}},{key:"get_tasks",value:function(){function s(s){e.results_callback(s),e.toggle_loading()}function t(){e.toggle_loading()}var a=this.gather_params();a.offset=this.offset,a.limit=this.limit;var e=this;CuckooWeb.api_post("api/tasks/recent/",a,s,null,t)}},{key:"load",value:function(){$("#recent>tbody").html(""),this.empty_results=!1,this.offset=0,this.params={cats:[],packs:[],score:""},this.get_tasks()}},{key:"lazy_load",value:function(){this.offset+=this.limit,this.get_tasks()}},{key:"results_callback",value:function(s){s=s.tasks,0==Object.keys(s).length?($("div#no_more_results").show(),$("div#no_more_results>span").html("no more results"),this.empty_results=!0):s.forEach(function(s,t){var a="<tr><td>";a+="<strong>"+s.id+"</strong></td><td>";var e="-",n="-";s.hasOwnProperty("completed_on")&&(e=CuckooWeb.getFormattedDate(s.completed_on)),s.hasOwnProperty("added_on")&&(n=CuckooWeb.getFormattedDate(s.added_on)),a+="reported"==s.status||"failed_analysis"==s.status?'<a href="'+s.id+'/summary"><span class="mono">'+e+"</span></a>":'<span class="mono muted">'+n+"</span>",a+="</td><td>",a+="reported"==s.status||"failed_analysis"==s.status?'<a href="'+s.id+'/summary"><span class="mono">'+s.md5+"</span></a>":'<span class="mono">'+s.md5+"</span>",a+="</td><td>",a+="reported"==s.status||"failed_analysis"==s.status?'<a href="'+s.id+'/summary">'+s.target+"</a>":s.category,a+="</td><td>","pending"==s.status?a+='<span class="text-muted">pending</span>':"running"==s.status?a+='<span class="text-warning">running</span>':"completed"==s.status?a+='<span class="text-info">completed</span>':"reported"==s.status?(a+=s.errors?'<span class="text-danger">':'<span class="text-success">',a+="reported</span>"):a+='<span class="text-danger">'+s.status+"</span>",a+="</td><td>";var r="default";s.hasOwnProperty("score")&&(s.score>=4&&s.score<=7?r="warning":s.score>7&&(r="danger")),a+='<span class="badge badge-'+r+'">score: '+s.score+"</span>",a+="</td></tr>",$("table#recent tbody").append(a)})}}]),s}();
//# sourceMappingURL=recent.js.map
