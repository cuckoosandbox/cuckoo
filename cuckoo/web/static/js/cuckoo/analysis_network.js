"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function parseHeaderString(e,t){var i,s=e.split(/\r?\n/),a=s.map(function(e){return e.split(":")}).map(function(e){return 1==e.length?{name:null,value:e[0]}:{name:e[0],value:e[1]}});return{headers:a,status_code:i}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),HexView=function(){function e(t,i,s){_classCallCheck(this,e),"object"!==("undefined"==typeof i?"undefined":_typeof(i))&&(i={response:i,request:""}),this.el=t,this.raw=i,this.container=s.container?s.container:null,this.locked=!1;var a=e.getPreferences();return this.displayBody=a.displayBody?a.displayBody:"response",this.displayOutput=a.displayOutput?a.displayOutput:"hex",this.displayMode=a.displayMode?a.displayMode:16,s.displayBody&&(this.displayBody=s.displayBody),s.displayOutput&&(this.displayOutput=s.displayOutput),s.displayMode&&(this.displayMode=s.displayMode),this.actions=$.extend({display:function(){},output:function(){},mode:function(){}},s.actions?s.actions:{}),this.events=$.extend({click:function(){},display:function(){},output:function(){},mode:function(){}},s.events?s.events:{}),this.el.data("hexView",this),this.el.attr("hexview",!0),this}return _createClass(e,[{key:"initialise",value:function(){var t=this;return this.container&&(this.container=this.el.find(this.container)),this.el.find(".flex-tabs__tab .btn").bind("click",function(i){if(i.preventDefault(),!t.locked){var s,a=$(this).attr("href").split(":"),n=a[0],o=a[1];"output"==n&&(t.displayOutput=o,s="displayOutput"),"mode"==n&&(t.displayMode=o,s="displayMode"),"display"==n&&(t.displayBody=o,s="displayBody"),t.actions[n].apply(t,[o,t.el]),t.events[n].apply(o,t.el),t.sync(),e.storePreferences({displayBody:t.displayBody,displayOutput:t.displayOutput,displayMode:t.displayMode}),e.persistProperty(s,o)}}),this.sync(),this}},{key:"sync",value:function(){this.el.find(".tab-mode > a").removeClass("active"),this.el.find('.tab-mode > a[href="mode:'+this.displayMode+'"]').addClass("active"),this.el.find(".tab-output > a").removeClass("active"),this.el.find('.tab-output > a[href="output:'+this.displayOutput+'"]').addClass("active"),this.el.find(".tab-display > a").removeClass("active"),this.el.find('.tab-display > a[href="display:'+this.displayBody+'"]').addClass("active"),"hex"==this.displayOutput?this.el.find(".tab-mode").show():this.el.find(".tab-mode").hide(),this.render()}},{key:"render",value:function(){var t=this.raw,i=this.displayBody,s=this.displayOutput,a=this.displayMode;t="hex"==s?e.renderHex(t[i],a):e.renderPlaintext(t[i]),0==t.length?this.el.addClass("empty-body"):this.el.removeClass("empty-body"),this.container.empty().text(e.unescapeHTML(t))}}],[{key:"renderHex",value:function(e,t){return hexy(base64.decode(e),{width:t?parseInt(t):16,html:!1})}},{key:"renderPlaintext",value:function(e){return base64.decode(e)}},{key:"getPreferences",value:function(){var e=window.localStorage.getItem("hex-view");return e?JSON.parse(e):{displayMode:16,displayOutput:"hex",displayBody:"response"}}},{key:"storePreferences",value:function(e){e=$.extend({displayMode:16,displayOutput:"hex",displayBody:"response"},e),window.localStorage.setItem("hex-view",JSON.stringify(e))}},{key:"persistProperty",value:function(e,t){$("[hexview='true']").each(function(){var i=$(this).data("hexView");i.hasOwnProperty(e)&&(i[e]=t,i.sync())})}},{key:"lockAll",value:function(t){t===!0?e.persistProperty("locked",!0):e.persistProperty("locked",!1)}},{key:"unescapeHTML",value:function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'")}}]),e}(),RequestDisplay=function(){function e(t){_classCallCheck(this,e),this.el=t,this.hex_view=void 0,this.isLoading=!1,this.isLoaded=!1,this.isOpen=!1,this.index=this.el.data("index"),this.protocol=this.el.data("protocol"),this.request_headers=this.el.find("[data-contents=request-headers]").html(),this.response_headers=this.el.find("[data-contents=response-headers]").html(),this.request_body=null,this.response_body=null,this.initialise()}return _createClass(e,[{key:"initialise",value:function(){var t=this,i=e.createHeaderTable(this.request_headers),s=e.createHeaderTable(this.response_headers);this.el.find("[data-draw=request-headers]").after(i),this.el.find("[data-draw=response-headers]").after(s),this.el.find(".removable").remove(),this.el.find(".network-display__request-summary").bind("click",function(e){e.preventDefault(),t.isLoading||(t.isLoaded?t.isOpen?t.close():t.open():t.load($(this)))})}},{key:"load",value:function(e){var t=this;this.isLoading=!0,this.el.addClass("is-loading"),e.find(".fa-chevron-right").addClass("fa-spinner fa-spin"),$.post("/analysis/api/task/network_http_data/",JSON.stringify({task_id:window.task_id,protocol:t.protocol,request_body:!1,request_index:t.index}),function(i){t.request_body=i.request,t.response_body=i.response,t.loadFinish(i,e)})}},{key:"loadFinish",value:function(e,t){var i=this;this.isLoading=!1,this.isLoaded=!0,this.el.removeClass("is-loading"),t.find(".fa-chevron-right").removeClass("fa-spinner fa-spin"),this.hex_view=new HexView(this.el,{request:i.request_body,response:i.response_body},{container:'[data-draw="source"]'}).initialise(),console.log(this.hex_view),i.open()}},{key:"open",value:function(){var e=this;e.el.addClass("is-open"),e.isOpen=!0}},{key:"close",value:function(){this.el.removeClass("is-open"),this.isOpen=!1,this.el.find("[data-draw=source]").empty()}}],[{key:"createHeaderTable",value:function(e){var t=HANDLEBARS_TEMPLATES["header-table"];return t({keyv:parseHeaderString(e).headers})}}]),e}(),PacketDisplay=function(){function e(t,i){_classCallCheck(this,e),this.options=$.extend({skip_empty:!1},i),this.nav=t.find("#requests"),this.container=t.find("#packets"),this.loader=t.find(".network-display__loader"),this.template=HANDLEBARS_TEMPLATES["packet-display"],this.initialise()}return _createClass(e,[{key:"initialise",value:function(){var e=this;this.nav.find(".source-destination a").length&&(this.nav.find(".source-destination a").bind("click",function(t){t.preventDefault(),e.selectHandler($(this))}),e.selectHandler(this.nav.find(".source-destination a:first-child")))}},{key:"selectHandler",value:function(e){var t=this,i=e.attr("href");i&&(this.loader.addClass("active"),this.container.addClass("is-loading"),HexView.lockAll(!0),this.load(i,function(e){var i=[];for(var s in e)if(!t.options.skip_empty||0!=e[s].raw.length){var a=new HexView($(t.template(e[s])),e[s].raw,{container:'[data-draw="source"]',displayBody:"response"});i.push(a)}t.container.empty(),i.forEach(function(e){t.container.append(e.el),e.initialise()});var n=0;t.container.parent().scrollTop()>0&&(n=1500),t.container.parent().animate({scrollTop:0},{duration:n,specialEasing:{scrollTop:"easeOutBounce"},complete:function(){HexView.lockAll(!1),t.loader.removeClass("active"),t.container.removeClass("is-loading")}})},function(e){console.log(e)}))}},{key:"load",value:function(e,t,i){$.get("/analysis/"+window.task_id+"/pcapstream/"+e+"/").done(function(e){t&&"function"==typeof t&&t(e)}).fail(function(e){console.log(e)})}}]),e}();$(function(){var e=["network-analysis-tcp","network-analysis-udp"],t=new PageSwitcher({nav:$(".network-analysis-groups"),container:$(".network-analysis-pages"),events:{beforeTransition:function(t,i){$(".cuckoo-analysis").removeClass("flex-nav__body--disable-overflow"),e.indexOf(t)!==-1&&$(".cuckoo-analysis").addClass("flex-nav__body--disable-overflow"),"network-analysis-http"==t&&i.el.find(".no-content").length&&$(".cuckoo-analysis").addClass("flex-nav__body--disable-overflow")}}});if(t.transition("network-analysis-http"),$("#network-analysis-tcp").length){new PacketDisplay($("#network-analysis-tcp"),{skip_empty:!0})}if($("#network-analysis-udp").length){new PacketDisplay($("#network-analysis-udp"),{skip_empty:!0})}$("#http-requests .network-display__request").each(function(){new RequestDisplay($(this))}),$(".source-destination .content li:first-child a").addClass("active"),$(".source-destination .content a").bind("click",function(e){e.preventDefault(),$(".source-destination a").removeClass("active"),$(this).addClass("active")})});
//# sourceMappingURL=analysis_network.js.map
