"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function alertbox(e,t,a){return t&&(t="alert-"+t),a&&(a='id="'+a+'"'),"<div "+a+' class="alert '+t+' signature">'+e+"</div>"}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),CuckooWeb=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"human_size",value:function(e,t){var a=t?1e3:1024;if(Math.abs(e)<a)return e+" B";var n=t?["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]:["kB","MB","GB","TB","PB","EB","ZB","YB"],i=-1;do e/=a,++i;while(Math.abs(e)>=a&&i<n.length-1);return e.toFixed(1)+" "+n[i]}},{key:"api_post",value:function(e,t,a,n,i){var s=JSON.stringify(t);$.ajax({type:"post",contentType:"application/json",url:e,dataType:"json",data:s,timeout:2e4,beforeSend:function(){i&&i()},success:function(e){a&&a(e)}}).fail(function(e){e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")?console.log("POST err: "+e.responseJSON.message):console.log("POST err: "+e),n&&n(e)})}},{key:"getFormattedDate",value:function(e){var t=new Date(e),a=t.getMonth()+1,n=t.getDate(),i=t.getHours(),s=t.getMinutes(),r=t.getSeconds();return a=(a<10?"0":"")+a,n=(n<10?"0":"")+n,i=(i<10?"0":"")+i,s=(s<10?"0":"")+s,r=(r<10?"0":"")+r,t.getFullYear()+"-"+a+"-"+n+" "+i+":"+s}},{key:"redirect",value:function(e){window.location.href=e}},{key:"toggle_page_freeze",value:function(e,t){e?($(".page-freeze__message").text(t),$(".page-freeze").addClass("in")):($(".page-freeze").removeClass("in"),$(".page-freeze__options").addClass("hidden"))}},{key:"error_page_freeze",value:function(e){$(".page-freeze").addClass("error"),$(".page-freeze__message").text(e),$(".page-freeze__options").removeClass("hidden")}},{key:"submit_url",value:function(t){return""!=t&&void e.api_post("/submit/api/presubmit",{data:t,type:"strings"},function(t){e.redirect("/submit/pre/"+t.submit_id)},function(e){console.log("err: "+e)})}},{key:"isRecommendedBrowser",value:function(){var e=["firefox","chrome","webkit","chromium","opera"],t=!1;for(var a in e)if(bowser[e[a]]){t=!0;break}return{recommended:t,browser:bowser.name}}},{key:"renderCode",value:function(e,t){if(!e)return!1;if(!t)var t={};return HANDLEBARS_TEMPLATES.code({code:e,type:t.type||void 0})}},{key:"escapeHTML",value:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,function(e){return t[e]})}},{key:"unescapeHTML",value:function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'")}}]),e}(),PageSwitcher=function(){function e(t){_classCallCheck(this,e),this.nav=t.nav,this.container=t.container,this.pages=[],this.events=$.extend({transition:function(){},beforeTransition:function(){},afterTransition:function(){}},t.events?t.events:{}),this.initialise()}return _createClass(e,[{key:"initialise",value:function(){var e=this;this.indexPages(),this.nav.find("a").bind("click",function(t){t.preventDefault(),e._beforeTransition($(this))})}},{key:"indexPages",value:function(){var e=this;this.container.children("div").each(function(t){e.pages.push({index:t,name:$(this).attr("id"),el:$(this),initialised:!1})})}},{key:"_beforeTransition",value:function(e){var t,a=e.attr("href").replace("#","");this.exists(a)?(this.nav.find("a").removeClass("active"),this.container.children("div").removeClass("active"),t=this.getPage(a),this.events.beforeTransition.apply(this,[a,t]),this._transition(t,e)):this._afterTransition()}},{key:"_transition",value:function(e,t){e.el.addClass("active"),t.addClass("active"),this.events.transition.apply(this,[e,t]),this._afterTransition(e)}},{key:"_afterTransition",value:function(e){this.events.afterTransition.apply(this,[e])}},{key:"getPage",value:function(e){return"string"==typeof e?this.pages.filter(function(t){return t.name==e})[0]:"number"==typeof e?this.pages[e]:void 0}},{key:"exists",value:function(e){return void 0!==this.getPage(e)}},{key:"transition",value:function(e){if("number"==typeof e)var e=this.getPage(e).name;return!!this.exists(e)&&void this._beforeTransition(this.nav.children("[href="+e+"]"))}}]),e}();$(document).ready(function(){var e=$(".app-message[data-message=browser-recommendation]"),t=CuckooWeb.isRecommendedBrowser();t.recommended||(e.find(".browser").text(t.browser),!window.localStorage.getItem("hide-browser-warning")==!0&&e.removeClass("hidden")),e.find('.button[href="#dismiss"]').bind("click",function(t){t.preventDefault(),e.addClass("hidden")}),e.find('.button[href="#hide"]').bind("click",function(t){t.preventDefault(),window.localStorage.setItem("hide-browser-warning",!0),e.addClass("hidden")}),$("[data-toggle=popover]").popover(),$(".close-page-freeze").bind("click",function(){CuckooWeb.toggle_page_freeze(!1),setTimeout(function(){$(".page-freeze").removeClass("error")},300)})}),$(function(){var e=$(".cuckoo-errors"),t=(e.find(".errors"),e.find(".show-all-errors a")),a=(e.find(".expand-error"),!1);$(".cuckoo-errors .expand-error").bind("click",function(e){e.preventDefault(),$(this).parent().hasClass("expanded")?($(this).attr("title","Expand error message"),$(this).parent().removeClass("expanded")):($(this).attr("title","Collapse error message"),$(this).parent().addClass("expanded"))}),t.bind("click",function(e){e.preventDefault(),a=!a})}),$(function(){$("#analysis .flex-grid__footer .logo a").bind("click",function(e){e.preventDefault(),$(this).parents(".flex-nav__body").scrollTop(0)})}),$(function(){function e(e){Cookies("theme",e,{expires:3650}),$("body").removeClass("cyborg night"),$("body").addClass(e),$(".app-nav__dropdown").removeClass("in")}$("#select-theme").bind("click",function(e){e.preventDefault(),$(this).parent().find(".app-nav__dropdown").toggleClass("in")}),$(".theme-selection a").bind("click",function(t){t.preventDefault(),$(".theme-selection a").removeClass("active"),$(this).addClass("active");var a=$(this).attr("href").split(":")[1];e(a)}),$("body").bind("click",function(e){0==$(e.target).parents(".app-nav__dropdown--parent").length&&$(".app-nav__dropdown").removeClass("in")})});var DashboardTable=function(){function e(t,a){_classCallCheck(this,e),this.options=$.extend({limit:3,afterLoad:function(){},afterRender:function(){}},a),this.el=t,this.limitSelect=this.el.find('[data-select="limit"]'),this.initialise()}return _createClass(e,[{key:"initialise",value:function(){var e=this;this.limitSelect.bind("change",function(){var t=$(this).val();e.changeLimit(t)}),this.load()}},{key:"changeLimit",value:function(e){this.options.limit=e,this.load()}},{key:"load",value:function(){var e=this,t=parseInt(this.options.limit);$.ajax({type:"POST",url:"/analysis/api/tasks/recent/",contentType:"application/json",dataType:"json",data:JSON.stringify({cats:[],limit:isNaN(t)?3:t,offset:0,packs:[],score:""}),success:function(t){t=t.tasks&&$.isArray(t.tasks)?t.tasks.map(function(e){return e.added_on&&(e.added_on=moment(e.added_on).format("DD/MM/YYYY")),e}):[],e.afterLoad(t)}})}},{key:"afterLoad",value:function(e){var t=parseInt(this.options.limit),a=this.generateTable(e.filter(function(e){return"reported"===e.status}).slice(0,t)),n=this.generateTable(e.filter(function(e){return"pending"===e.status}).slice(0,t));this.el.find("[data-populate='dashboard-table-recent']").html(a),this.el.find("[data-populate='dashboard-table-pending']").html(n),this.options.afterRender({$recent:this.el.find("[data-populate='dashboard-table-recent']"),$pending:this.el.find("[data-populate='dashboard-table-pending']")})}},{key:"generateTable",value:function(e){var t=this.options.limit;return HANDLEBARS_TEMPLATES["dashboard-table"]({entries:e,lessEntries:e.length<t})}}],[{key:"simpleTable",value:function(e){var t=$("<div />");for(var a in e){var n=e[a],i=$("<tr />");i.append("<td>"+a+"</td>"),i.append("<td>"+n+"</td>"),t.append(i)}return t.html()}}]),e}();$(function(){function e(e,t,a){var n,i=e[0],s=t.total,r=t.free,o=t.used,l=100/s*r,d=100/s*o,c=CuckooWeb.human_size(r),u=CuckooWeb.human_size(s),p="#52B3D9",f="#afb200",h="#999";return d>75&&(p=f),i&&(n=new Chart(i,{type:"doughnut",data:{labels:["Free","Used"],datasets:[{data:[l,d],backgroundColor:[p,h]}]},options:{cutoutPercentage:70,legend:{display:!1},tooltips:{enabled:!1}}})),a&&(c=Math.round(l),u=100),{free:c,total:u,used:Math.round(d)}}if(Chart.defaults.global.responsive=!1,$(".omni-uploader").length&&window.DnDUpload){var t=new DnDUpload.Uploader({target:"div#dashboard-submit",endpoint:"/submit/api/presubmit/",template:HANDLEBARS_TEMPLATES.dndupload_simple,ajax:!0,templateData:{title:"Submit a file for Analysis",html:'<i class="fa fa-upload"></i>\n'+$("#analysis_token").html()},dragstart:function(e,t){$(t).removeClass("dropped"),$(t).addClass("dragging")},dragend:function(e,t){$(t).removeClass("dragging")},drop:function(e,t){$(t).addClass("dropped")},success:function(e,t){setTimeout(function(){window.location.href=e.responseURL},1e3)},change:function(e,t){$(t).addClass("dropped")}});t.draw()}if($("#cuckoo-dashboard").length){new DashboardTable($("#dashboard-tables"),{limit:3,limitOptions:[1,2,3,5,10,20,50,100],afterRender:function(e){e.$recent.find("tr:not(.less-entries)").addClass("clickable"),e.$recent.find("tr:not(.less-entries)").bind("click",function(e){var t=$(this).find("td:first-child").text();window.location="/analysis/"+t+"/summary/"})}});$.get("/cuckoo/api/status",function(t){var a=DashboardTable.simpleTable(t.data.tasks);if($('[data-populate="statistics"]').html(a),t.data.diskspace.analyses){var n=e($("#ds-stat > canvas"),t.data.diskspace.analyses);$('[data-populate="free-disk-space"]').text(n.free),$('[data-populate="total-disk-space"]').text(n.total)}else $("#ds-stat").addClass("no-data");if(t.data.cpucount){var i=t.data.cpucount,s=0;for(var r in t.data.cpuload)s+=t.data.cpuload[r];var o=parseInt(s/t.data.cpuload.length*100/i);$('[data-populate="cpu-load"]').text(o+"%"),$('[data-populate="total-cores"]').text(i+" cores");e($("#cpu-stat > canvas"),{total:100*i,used:o,free:100-o})}else $("#cpu-stat").addClass("no-data");if(t.data.memtotal){var l=t.data.memtotal,d=t.data.memavail,c=(e($("#memory-stat > canvas"),{total:l,used:l-d,free:d},!0),CuckooWeb.human_size(1e3*l)),u=CuckooWeb.human_size(1e3*d);CuckooWeb.human_size(1e3*(l-d));$('[data-populate="memory-used"]').text(""+u),$('[data-populate="memory-total"]').text(""+c)}else $("#memory-stat").addClass("no-data")}),$("#submit-with-link form").bind("submit",function(e){e.preventDefault();var t=$("#submit-with-link textarea").val();CuckooWeb.submit_url(t)})}$(".page-switcher").each(function(){var e=new PageSwitcher({nav:$(this).find(".page-switcher__nav"),container:$(this).find(".page-switcher__pages")});$(this).data("pageSwitcher",e)})}),$(function(){if($("body#analysis").length&&($(".cuckoo-analysis").focus(),$("#analysis-nav, #primary-nav").bind("click",function(){$(".cuckoo-analysis").focus()})),$("#submit-extracted-urls").bind("click",function(e){e.preventDefault();var t=$(this).parents(".list-panel").find(".list-group-item"),a=[];t.each(function(){a.push($(this).text())}),a=a.join("\n"),CuckooWeb.submit_url(a)}),hljs&&(hljs.configure({languages:["js"]}),hljs.initHighlightingOnLoad(),$("pre code").each(function(e,t){hljs.highlightBlock(t)})),$(".extracted-switcher").length){var e;!function(){var t=function(e){var t=e.find("[data-powershell-source]").attr("data-powershell-source");$.get(t).success(function(t){var a=S(t).replaceAll(";",";\n"),n=$(CuckooWeb.renderCode(a),{type:"powershell"});n.find("code").each(function(e,t){hljs.highlightBlock(t)}),e.find(".powershell-preview").html(n),e.addClass("powershell-loaded")}).error(function(){e.find(".powershell-preview").html('<p class="alert alert-danger">Something went wrong loading the script. Please try again later.</p>')})};e=$(".extracted-switcher").data("pageSwitcher"),e.events.afterTransition=function(e){e.el.hasClass("powershell-loaded")||t(e.el)},e.transition(0)}()}}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
//# sourceMappingURL=app.js.map
