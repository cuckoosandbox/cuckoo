!function e(t,i,n){function a(s,r){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!r&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return a(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,i){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){var e=$("body").attr("id");return e.indexOf("/")>-1&&(e=e.split("/")[1]),e}function s(e){var e=new d.Form(e);return e}function r(e,t){var i=new p.FileTree(e,t);return i}function l(e){var t=new m.Uploader(e);return t}Object.defineProperty(i,"__esModule",{value:!0}),i.AnalysisInterface=void 0;var c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=e("./InterfaceControllers"),d=n(u),f=e("./FileTree"),p=n(f),h=e("./DnDUpload"),m=n(h);window.DnDUpload=m;var v={container:null,filetree:p.DEFAULT_FILETREE_CONFIG,dndupload:m.DEFAULT_UPLOADER_CONFIG},g=function(){function e(t){a(this,e),this.options=$.extend(!0,v,t),this.dndupload=null,this.filetree=null,this.form=null,this.originalData=null,this.initialise()}return c(e,[{key:"initialise",value:function(){var e=this,t=o();"index"==t&&(this.dndupload=l(this.options.dndupload),this.dndupload.draw()),"pre"==t&&(this.filetree=r(this.options.container.querySelector("#filetree"),this.options.filetree),this.filetree.loaded=function(){e.form=s(e.options.form)})}},{key:"getData",value:function(e,t){var i={};if(i.global=this.form.serialize(),i.file_selection=this.filetree.serialize(),e)for(var n in e)i[n]=e[n];return i.file_selection=i.file_selection.map(function(e){return e.per_file_options&&(e.options=e.per_file_options,delete e.per_file_options),e.children&&delete e.children,e}),t&&(i=JSON.stringify(i)),i}}]),e}();i.AnalysisInterface=g},{"./DnDUpload":2,"./FileTree":3,"./InterfaceControllers":4}],2:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=!1,s={target:null,endpoint:null,template:null,ajax:!0,templateData:{},dragstart:function(){},dragend:function(){},drop:function(){},error:function(){},success:function(){},progress:function(){},change:function(){}},r=function(){function e(t){n(this,e);var i=this;this.options=$.extend({target:null,endpoint:null,template:null,ajax:!0,templateData:{},dragstart:function(){},dragend:function(){},drop:function(){},error:function(){},success:function(){},progress:function(){},change:function(){}},t),this.endpoint=this.options.endpoint,this._success_callback=this.options.success,this._progress_callback=this.options.progress,this._dragstart_callback=this.options.dragstart,this._dragend_callback=this.options.dragend,this._drop_callback=this.options.drop,this._error_callback=this.options.error,this._change_callback=this.options.change,this._selectors={uid:"dndupload_"+e.generateUUID(),target:i.options.target},this.html=null,this._usesTemplate=!1,this._bound=!1}return a(e,[{key:"draw",value:function(){$(this._selectors.target).empty();var e='\n            <div class="dndupload" id="'+this._selectors.uid+'">\n                <form id="uploader" action="/submit/api/presubmit" method="POST" enctype="multipart/form-data">\n                    <div id="container">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43">\n                            <path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"/>\n                        </svg>\n    \n                        <input type="file" name="files[]" id="file" class="holder_input" data-multiple-caption="{count} files selected" multiple="">\n                        <label for="file" id="info">\n                            <strong>Choose files</strong>\n                            <span class="box__dragndrop"> or drag them here</span>.\n                        </label>\n    \n                        <button type="submit" class="holder_button">Upload</button>\n    \n                        <progress id="uploadprogress" min="0" max="100" value="0">0</progress>\n                    </div>\n                </form>\n            </div>\n        ';if(this.options.template){this._usesTemplate=!0,this.options.templateData.uid=this._selectors.uid,this.options.templateData.inputName||(this.options.templateData.inputName="files");var e=this.options.template(this.options.templateData)}$(this._selectors.target).append(e),this._bound||this._bind()}},{key:"_bind",value:function(){var e=this,t=document.querySelector("div#"+e._selectors.uid);e._selectors.holder=t,e._selectors.progress=document.querySelector(e._selectors.target).querySelector("progress#uploadprogress"),e._selectors.upload=t.querySelector("upload"),e._selectors.form=t.querySelector("form#uploader"),e._selectors.tests={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest},e._selectors.support={filereader:document.getElementById("filereader"),formdata:document.getElementById("formdata"),progress:document.getElementById("progress")},"filereader formdata progress".split(" ").forEach(function(t){if(e._selectors.tests[t]===!1){if(!e._selectors.support[t])return;e._selectors.support[t].className="fail"}else{if(!e._selectors.support[t])return;e._selectors.support[t].className="hidden"}}),e._selectors.holder.querySelector('input[type="file"]').addEventListener("change",function(i){if(e.options.ajax){var n=document.createEvent("HTMLEvents");n.initEvent("submit",!0,!0),e._selectors.form.dispatchEvent(n),e._change_callback(e,t)}else $(e._selectors.form).submit()}),$(e._selectors.form).bind("submit",function(t){e.options.ajax&&(t.preventDefault(),this._process_files())}.bind(this)),e._selectors.tests.dnd?(t.querySelector("form#uploader").ondragover=function(){return this.className="hover",e._dragstart_callback(e,t),!1},t.querySelector("form#uploader").ondragend=function(){return this.className="",!1},["dragleave","dragend","drop"].forEach(function(i){t.querySelector("form#uploader").addEventListener(i,function(){this.classList.remove("hover"),e._dragend_callback(e,t)})}),t.querySelector("form#uploader").ondrop=function(i){if(this.className="",e.options.ajax){i.preventDefault();var n=e._drop_callback(e,t);if(n===!1)return;e._process_files(i.dataTransfer.files)}else i.dataTransfer.files&&(e._selectors.holder.querySelector('input[type="file"]').files=i.dataTransfer.files)}):(this._selectors.upload.className="hidden",this._selectors.upload.querySelector("input").onchange=function(){e.options.ajax&&e._process_files(this.files)}),this._bound=!0}},{key:"_process_files",value:function(e){if(!o){var t=this,i=new FormData;if(t._selectors.holder.querySelector('input[type="file"]').files&&!e)i=new FormData(t._selectors.form);else for(var n=0;n<e.length;n++)i.append("files[]",e[n]);i&&this._upload(i)}}},{key:"_upload",value:function(e){var t=this,i=new XMLHttpRequest;e.type="files",i.open("POST",this.endpoint),i.onload=function(){t._selectors.progress.value=t._selectors.progress.innerHTML=100,t._progress_callback&&t._progress_callback.bind(t,100,document.querySelector("div#"+t._selectors.uid))()},i.onreadystatechange=function(){4===i.readyState&&(200==i.status?setTimeout(function(){t._success_callback(i,document.querySelector("div#"+t._selectors.uid))},600):0==i.status||t._error_callback(t,document.querySelector("div#"+t._selectors.uid)))},this._selectors.tests.progress&&(i.upload.onprogress=function(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;t._selectors.progress.value=t._selectors.progress.innerHTML=i,t._progress_callback&&t._progress_callback.bind(t,100,document.querySelector("div#"+t._selectors.uid))()}}),i.send(e)}}],[{key:"generateUUID",value:function(){return(new Date).getTime()}}]),e}();i.Uploader=r,i.DEFAULT_UPLOADER_CONFIG=s},{}],3:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){var t=e.name;return this.options.config.nameKey&&(t=e[this.options.config.nameKey]),CuckooWeb.escapeHTML(t)}function o(e,t,i){var n=(t+"-"+e.filetree.index,document.createElement("input")),a=document.createElement("label"),o=document.createElement("span");return o.innerHTML=i,n.setAttribute("type","checkbox"),n.setAttribute("id",t+"-"+e.filetree.index),a.setAttribute("for",t+"-"+e.filetree.index),a.setAttribute("data-index",e.filetree.index),n.setAttribute("value",e.filetree.index),e.duplicate&&(e.selected=!1),e.selected&&n.setAttribute("checked",!0),a.appendChild(n),a.appendChild(o),a}function s(e,t){var i=document.createElement("li"),n=document.createElement("strong"),s=document.createElement("div"),r=o(e,t.options.config.label,a.call(t,e));return i.appendChild(n),s.appendChild(r),n.appendChild(s),s.setAttribute("data-type","folder"),t.transform("folder",i,e)}function r(e,t){var i=document.createElement("li"),n=document.createElement("div"),s=o(e,t.options.config.label,a.call(t,e));return i.appendChild(n),n.appendChild(s),n.setAttribute("data-type","file"),t.transform("file",i,e)}function l(e,t){function i(e){return c.options.config.isDirectory?c.options.config.isDirectory(e):e.hasOwnProperty("children")}var n,a,o,c=this;for(var u in e){var d=e[u];if(x+=1,d.filetree={index:x,is_directory:i(d),is_package:!1,el:null},d.preview||(d.filetree.is_directory=!1,d.filetree.is_package=!0),i.call(this,d)){n=s(d,this),o=l.call(this,d.children,document.createElement("ul")),t.appendChild(n);var f=n.getElementsByTagName("strong")[0];f.parentNode.insertBefore(o,f.nextSibling),d.filetree.el=n}else a=r(d,this),t.appendChild(a),d.filetree.el=a;d.duplicate&&d.filetree.el.classList.add("is-duplicate")}return t}function c(e,t){var i=!1;$(this).parent().hasClass("expanded")?$(this).parent().removeClass("expanded"):($(this).parent().addClass("expanded"),i=!0),t.options.events.folder_click&&t.options.events.folder_click(i)}function u(e,t){t.options.events.file_click&&t.options.events.file_click()}function d(e,t){e.forEach(function(e){e.selected=t,$(e.filetree.el).find("input").prop("checked",t),e.children&&d(e.children,t)})}function f(e,t){function i(e){t&&t(e),e&&e.parent&&i(e.parent)}e&&i(e)}function p(e){var t=/(?:\.([^.]+))?$/,i=[],n=void 0;return e.forEach(function(e){if(n=t.exec(e.filename),n.index>0&&i.indexOf(n[1])==-1){if("string"!=typeof n[1])return;i.push(n[1])}}),i}function h(e,t){t||(t=e.selected),e&&(t?f(e.parent,function(e){$(e.filetree.el).find("label:first").addClass("has-selected-child")}):f(e.parent,function(e){var t=!1;e.children&&e.children.forEach(function(e){e.selected&&(t=!0)}),t||$(e.filetree.el).find("label:first").removeClass("has-selected-child")}))}function m(e,t,i){var n=i.getIndex(t);n.selected=e,n.children&&d(n.children,e),i.options.events.select&&i.options.events.select.call(i,n,i.findByProperty("selected",!0)),$(this).parent().hasClass("custom-checkbox")&&$(n.filetree.el).find("input:checkbox").prop("checked",e),i.activeIndex&&i.activeIndex==n.filetree.index&&$(i.options.config.sidebar).find("header input:checkbox").prop("checked",e),n.parent&&h(n,e),i.update(),i.selectionViewActive&&i.selectionView()}function v(e,t,i){var n=$(this).find("#selection-overview");if(n.find("[data-index]").removeClass("hidden"),e.length>0){n.find("[data-index]").addClass("hidden");var a=t.filter(function(t){return t.filename.toLowerCase().indexOf(e.toLowerCase())>-1}).map(function(e){return"[data-index="+e.filetree.index+"]"});n.find(a.join(",")).removeClass("hidden"),a.length?n.find(".no-results").addClass("hidden"):n.find(".no-results").removeClass("hidden")}else n.find(".no-results").addClass("hidden")}function g(e){function t(e){for(var n in e)e[n].size&&(i+=parseInt(e[n].size)),e[n].children&&t(e[n].children)}var i=0;if(e)return t(e.children),i}function _(e,t){return t?S(e).truncate(t).s:e}function b(e,t,i){i||(i="span");var n=document.createElement(i);return n.classList.add("label"),n.classList.add("label-"+e),n.innerHTML=t,n}function y(e,t){var i=t?1e3:1024;if(Math.abs(e)<i)return e+" B";var n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=i,++a;while(Math.abs(e)>=i&&a<n.length-1);return e.toFixed(1)+" "+n[a]}Object.defineProperty(i,"__esModule",{value:!0});var k=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),w={config:{label:"ft",autoExpand:!1,sidebar:null,nameKey:"filename",isDirectory:function(e){return"directory"===e.type}},load:{url:null,method:null,params:{},serialize:function(e){return e}},transform:{file:function(e,t){return e},folder:function(e,t){return e}},events:{folder_click:function(e){},file_click:function(){},select:function(e,t){},ready:function(){}},templates:{},after:{detailView:function(){},selectionView:function(){}}},x=0,E=HANDLEBARS_TEMPLATES["submission-file-detail"],T=HANDLEBARS_TEMPLATES["submission-selection-list"],C=function(){function e(t,i){n(this,e),this.el=t,this.options=i,this.data=null,this.selectionViewActive=!1,this.detailViewActive=!1,this.activeIndex=null,this.loaded=null,this.interactionHandlers={expandAllFolders:function(){$(this.el).find('[data-type="folder"]').parent().not(".skip-auto-expand").addClass("expanded"),this.update()},collapseAllFolders:function(){$(this.el).find(".expanded").removeClass("expanded"),this.update()},selectAll:function(){d(this.data.children,!0),this.update(),this.selectionView()},deselectAll:function(){d(this.data.children,!1),$(this.el).find(".has-selected-child").removeClass("has-selected-child"),this.update(),this.selectionView()},showSelection:function(){this.selectionView()}},this.options.load.url&&this.load(this.options.load.url,this.options.load.params)}return k(e,[{key:"initialise",value:function(e){this.data={children:e},this.construct(),this.options.events.ready&&this.options.events.ready.call(this),this.options.config.autoExpand&&this.interactionHandlers.expandAllFolders.call(this)}},{key:"construct",value:function(){x=0,this.el.innerHTML="";var e=l.call(this,this.data.children,document.createElement("ul"));this.el.appendChild(e),this.connectListeners(),this.update(),this.selectionView(),this.each(function(e){e.parent&&h(e,e.selected)})}},{key:"connectListeners",value:function(){var e=this;$(this.el).find("li div").bind("click",function(t){var i=$(this).data("type"),n=$(this).find("[data-index]").data("index");"file"==i&&e.detailView(e.getIndex(n))}),$(this.el).find('[data-type="folder"]').bind("click",function(t){t.preventDefault(),c.call(this,t,e)}),$(this.el).find('[data-type="file"]').bind("click",function(t){t.preventDefault(),u.call(this,t,e)}),$(this.el).find("label").bind("click",function(e){e.stopPropagation()}),$(this.el).find("input:checkbox").on("change",function(t){m.call(this,$(this).is(":checked"),$(this).parent().data("index"),e)}),$("*[href^='filetree:']").bind("click",function(t){t.preventDefault();var i=$(this).attr("href").split(":")[1];e.interactionHandlers.hasOwnProperty(i)&&e.interactionHandlers[i].call(e)})}},{key:"update",value:function(){$('[data-value^="filetree:totalFilesCount"]').text(x),$('[data-value^="filetree:selectedFilesCount"]').text(this.findByProperty("selected",!0).length)}},{key:"load",value:function(e,t){function i(e){n.options.load.serialize&&(e=n.options.load.serialize(e)),n.loaded&&"function"==typeof n.loaded&&n.loaded(e),n.initialise(e)}var n=this;return t?CuckooWeb.api_post("/submit/api/filetree/",t,i):$.get(e).done(i),this}},{key:"transform",value:function(e,t,i){return this.options.transform[e]?this.options.transform[e].call(i,t,this):t}},{key:"getIndex",value:function(e){function t(i){var n;return i.forEach(function(i){n||(i.filetree.index==e?n=i:i.children&&(n=t(i.children)))}),n}var i=void 0;return this.data?t(this.data.children,e):i}},{key:"findByProperty",value:function(e,t,i){function n(i){i.forEach(function(i){i.children&&n(i.children),i[e]===t&&a.push(i)})}var a=[];return this.data?(n(this.data.children),a):a}},{key:"detailView",value:function(e){var t=this;if("directory"!==e.type){var i=E({item:e});this.selectionViewActive=!1,this.detailViewActive=!0,this.activeIndex=e.filetree.index,this.options.config.sidebar.innerHTML=i,$(this.options.config.sidebar).find("header input:checkbox").bind("change",function(){m.call(this,$(this).is(":checked"),e.filetree.index,t)}),this.options.after.detailView.call(e,this.options.config.sidebar,this)}}},{key:"selectionView",value:function(){var e=this,t=30,i=this.findByProperty("selected",!0),n=p(i);i.forEach(function(e){e.filename&&e.filename.length>t&&(e.fname_short=_(e.filename,t)),e.relapath&&e.relapath.length>t&&(e.rpath_short=_(e.relapath,t+10))});var a=T({selection:i,empty:i.length<=0,extensions:n});this.detailViewActive=!1,this.activeIndex=null,this.selectionViewActive=!0,this.options.config.sidebar.innerHTML=a,$(this.options.config.sidebar).find("a").bind("click",function(t){t.preventDefault();var i=e.getIndex(parseInt($(this).attr("href")));e.detailView(i)}),$(this.options.config.sidebar).find("#search-selection").bind("keyup",function(t){v.call(e.options.config.sidebar,this.value,i,e),$(e.options.config.sidebar).find(".extension-select select").find("option:first-child").prop("selected",!0),$(e.options.config.sidebar).find(".extension-select select").addClass("none-selected")}),$(this.options.config.sidebar).find(".extension-select select").bind("change",function(t){v.call(e.options.config.sidebar,"."+this.value,i,e),$(e.options.config.sidebar).find("#search-selection").val(""),$(e.options.config.sidebar).find(".extension-select select").removeClass("none-selected")}),this.options.after.selectionView.call(i,this.options.config.sidebar,this)}},{key:"serialize",value:function(){function e(e,t){var i={};for(var n in e)i[e[n]]=t[e[n]];return i}var t=this.findByProperty("selected",!0);return t.map(function(e){var t={};for(var i in e)"filetree"!==i&&(t[i]=e[i]);return t}).map(function(t){return t.options=e(t.changed_properties,t.per_file_options),t.filetree&&delete t.filetree,t.parent&&delete t.parent,t.fname_short&&delete t.fname_short,t.rpath_short&&delete t.rpath_short,t})}},{key:"each",value:function(e){function t(i,n){i.forEach(function(i){i.children&&t(i.children,e),n&&"function"==typeof n&&n(i)})}t(this.data.children,e)}}],[{key:"iterateFileStructure",value:function(e,t){function i(e,n,a){e.forEach(function(e,o){a&&(e.parent=a),e.children&&i(e.children,t,e),n&&"function"==typeof n&&n(e)})}i(e,t)}},{key:"getParentContainerName",value:function(e){function t(e){e.parent?t(e.parent):i=e}var i={};return e.parent&&t(e.parent),i}}]),e}();i.FileTree=C,i.Label=b,i.humanizeBytes=y,i.folderSize=g,i.DEFAULT_FILETREE_CONFIG=w},{}],4:[function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r={TopSelect:HANDLEBARS_TEMPLATES["control-top-select"],SimpleSelect:HANDLEBARS_TEMPLATES["control-simple-select"],ToggleList:HANDLEBARS_TEMPLATES["control-toggle-list"]},l=function(){function e(t){o(this,e),this.elements=[];for(var i in t)this.add(t[i])}return s(e,[{key:"add",value:function(e){return!e instanceof c?void console.error("Split only takes in UserInputControllers"):(e.view.split_view=this,void this.elements.push(e))}},{key:"draw",value:function(){var e=document.createElement("div");e.classList.add("fieldset__split");for(var t in this.elements){var i=this.elements[t].view.render();e.appendChild(i)}return e}},{key:"on",value:function(e,t){e&&"string"==typeof e&&(t||"function"==typeof t)&&this.elements.forEach(function(i){i.on(e,t)})}}]),e}(),c=function(){function e(t){o(this,e),this.controller=t,this.template=null,this.html=null,this.model=null,this.split_view=null,this.callbacks={}}return s(e,[{key:"createWrapper",value:function(){var e=document.createElement("fieldset");return e.classList.add("flex-form__module"),e.setAttribute("id",this.controller.name),e}},{key:"setupModel",value:function(e){if(this.model)for(var t in e)this.model[t]=e[t];else this.model=e}},{key:"render",value:function(){var e=this.template(this.model),t=this.createWrapper();return t.innerHTML=e,this.html=t,t}},{key:"runCallbacks",value:function(){var e=this;for(var t in this.callbacks)this.callbacks instanceof Function&&this.callbacks[t].call(this.html,this.controller),this.callbacks instanceof Array&&this.callbacks[t].forEach(function(t){"function"==typeof t&&t.call(e.html,e.controller)})}},{key:"afterRender",value:function(e){e&&(this.callbacks.afterRender=e)}}]),e}(),u=function(){function e(t){if(o(this,e),t||(t={}),this.config=t,this.view=new c(this),this.name=t.name||"",this.title=t.title||"",this.value=t.value||"",this.type=t.type||"",this.form=t.form||"",this.default=t.default||"",this.units=t.units||"",this.events={change:[],render:[],init:[]},t.on)for(var i in t.on)this.on(i,t.on[i]);this.default.length&&(this.value=this.default),this.view.setupModel({name:this.name,title:this.title,controller:this})}return s(e,[{key:"setValue",value:function(e,t){this.value=e,this.trigger("change",this.value),t&&t()}},{key:"getValue",value:function(){return this.value}},{key:"on",value:function(e,t){if(this.events.hasOwnProperty(e)&&t)return this.events[e].push(t),this}},{key:"trigger",value:function(e,t){var i=this;if(this.events.hasOwnProperty(e))return this.events[e].forEach(function(e){e.call(i,t)}),this}}]),e}(),d=function(e){function t(e){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.options=e.options,i.initialise(),i}return a(t,e),s(t,[{key:"initialise",value:function(){var e=this;this.view.template=r.SimpleSelect,this.view.setupModel({options:this.options,doc_link:this.config.doc_link}),this.default&&this.options.forEach(function(t){t.value==e.default&&(t.selected=!0,e.setValue(e.default))}),this.view.afterRender(function(e){$(this).find("select").bind("change",function(){e.setValue(this.value)})})}}]),t}(u),f=function(e){function t(e){o(this,t),e||(e={});var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.options=i.config.options,i.extra_select=i.config.extra_select,i.units=i.config.units,i.initialise(),i}return a(t,e),s(t,[{key:"initialise",value:function(){var e=this,t=this.extra_select,i=this.options.length,n=[],a=[],o=!1;i>=5?(n=this.options.slice(0,5),a=this.options.slice(5,i)):n=this.options,this.default&&(this.options.forEach(function(t){t.value==e.default&&(t.selected=!0,e.setValue(e.default),o=!0)}),o||(e.setValue(e.default),$(e.view.html).find(".manual-input > input").val(e.getValue()))),this.view.template=r.TopSelect,this.view.deselectRadios=function(){$(this.html).find("input:radio").prop("checked",!1)},this.view.unsetCustom=function(){$(this.html).find(".manual-input").removeClass("active"),$(this.html).find(".manual-input > input").val("")},this.view.resetOtherSelect=function(){$(this.html).find('select[name="'+this.controller.name+'-other"] option:first-child').prop("selected",!0)},this.view.resetAlternateSelect=function(){t&&$(this.html).find("select#"+t.name+" option:first-child").prop("selected",!0)},this.view.setupModel({top_items:n,rest_items:a,extra_select:this.config.extra_select,doc_link:this.config.doc_link,snapped:o}),this.view.afterRender(function(i){if($(this).find("input:radio").bind("change",function(t){i.setValue(this.value),e.view.resetOtherSelect(),e.view.resetAlternateSelect(),e.view.unsetCustom()}),$(this).find('select[name="'+i.name+'-other"]').bind("change",function(t){i.setValue(this.value),e.view.deselectRadios(),e.view.resetAlternateSelect(),e.view.unsetCustom()}),$(this).find(".manual-input > input").bind("keyup",function(t){i.setValue(this.value),$(this).parent().addClass("active"),e.view.deselectRadios(),e.view.resetAlternateSelect()}),o||($(this).find(".manual-input").addClass("active"),$(this).find(".manual-input > input").val(e.value)),t){var n=new u({name:t.name,title:t.title,on:t.on||{}});t.default&&t.options.forEach(function(e){e.value==t.default&&(e.selected=!0,n.setValue(t.default))}),i.form&&i.form.add(n),$(i.view.html).find("select#"+t.name).bind("change",function(t){n.setValue($(this).val()),e.view.deselectRadios(),e.view.resetOtherSelect()})}})}},{key:"getValue",value:function(){return this.value}}]),t}(u),p=function(e){function t(e){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(i.initialised=!1,i.options=e.options,i.config=e,i.value={},i.custom_options=e.custom_options||{},i.options_extra_predefined=e.options_extra_predefined||[],i.events=$.extend(i.events,{remove:[]}),i.default){var a=i;i.options=i.options.map(function(e){return e.selected=!1,a.default[e.name]===!0&&(e.selected=!0),e})}return i.initialise(),i}return a(t,e),s(t,[{key:"initialise",value:function(){var e=this;this.view.template=r.ToggleList,this.view.setupModel({options:this.options,extraOptions:this.config.extraOptions,doc_link:this.config.doc_link});for(var t in this.options)this.value[this.options[t].name]=this.options[t].selected||!1;return this.trigger("init"),this.view.afterRender(function(){$(this).find("input:checkbox").bind("change",function(t){e.onToggleChange.call(this,t,e)}).each(function(){e.onToggleChange.call(this,null,e)}),e.config.extraOptions&&e.initialiseExtraOptions(),e.initialised=!0}),this}},{key:"setOption",value:function(e,t){this.value[e]=t,this.initialised&&this.trigger("change",this.getValue())}},{key:"onToggleChange",value:function(e,t){var i=$(this),n=i.data("option");t.setOption(n,i.is(":checked"))}},{key:"initialiseExtraOptions",value:function(){var e=this,t=$(this.view.html).find("table tfoot input[name=new-key]"),i=$(this.view.html).find("table tfoot input[name=new-value]");$(this.view.html).find("table tfoot input[name=new-key], table tfoot input[name=new-value]").bind("keydown",function(n){var a=t.val(),o=i.val();switch(n.keyCode){case 13:e.commit(a,o)}}),this.options_extra_predefined.length&&this.options_extra_predefined.forEach(function(t){e.commit(t.key,t.value)})}},{key:"removeTableRow",value:function(e){$(this.view.html).find('tr[data-option="'+e+'"]').remove()}},{key:"createTableRow",value:function(e,t){var i=document.createElement("tr"),n=document.createElement("td"),a=document.createElement("td"),o=document.createElement("a"),s=document.createElement("i");return o.classList.add("remove"),s.classList.add("fa"),s.classList.add("fa-remove"),o.appendChild(s),n.innerHTML=e,a.innerHTML=t,a.appendChild(o),i.appendChild(n),i.appendChild(a),n.classList.add("key"),a.classList.add("value"),i.setAttribute("data-option",e),i}},{key:"commit",value:function(e,t){var i=this,n=$(this.view.html).find("table tfoot input[name=new-key]"),a=$(this.view.html).find("table tfoot input[name=new-value]");if(this.custom_options.hasOwnProperty(e))return!1;if(!e||!t)return!1;this.custom_options[e]=t;var o=this.createTableRow(e,t);$(this.view.html).find("table tbody").append(o),$(o).find(".remove").bind("click",function(e){e.preventDefault(),i.remove($(this).parents("tr").data("option")),i.trigger("remove",i.getValue())}),n.val(""),a.val(""),n.focus(),this.trigger("change",this.getValue())}},{key:"remove",value:function(e){this.custom_options.hasOwnProperty(e)&&(delete this.custom_options[e],this.removeTableRow(e))}},{key:"getValue",value:function(){var e={};for(var t in this.value)e[t]=this.value[t];if(this.config.extraOptions)for(var i in this.custom_options)e[i]=this.custom_options[i];return e}}]),t}(u),h=function(){function e(t){o(this,e),this.config=t,this.fields={},this.container=this.config.container||null,this.events={change:[],render:[]},this.config.configure.call({TopSelect:f,SimpleSelect:d,Split:l,ToggleList:p},this)}return s(e,[{key:"on",value:function(e,t){if(this.events.hasOwnProperty(e)&&t)return this.events[e].push(t),this}},{key:"trigger",value:function(e,t){var i=this;if(this.events.hasOwnProperty(e))return this.events[e].forEach(function(e){e.call(i,t)}),this}},{key:"add",value:function(e){var t=this;e instanceof Array?e.forEach(function(e){if(e instanceof Array){var i=new l(e);t.add(i)}else t.add(e)}):e instanceof u||e instanceof l?(this.fields[e.name]=e,this.fields[e.name].form=this,e.on("change",function(){t.trigger("change",t.serialize())})):console.error("Only elements from instance UserInputController and Split are allowed!")}},{key:"draw",value:function(){for(var e in this.fields){var t=this.fields[e];if(t instanceof u)t.view.html=t.view.render(),this.container.appendChild(t.view.html),t.view.callbacks.afterRender&&t.view.callbacks.afterRender.call(t.view.html,t);else if(t instanceof l){this.container.appendChild(t.draw());for(var i in t.elements){var e=t.elements[i];e.view.callbacks.afterRender&&e.view.callbacks.afterRender.call(e.view.html,e)}}}}},{key:"serialize",value:function(){function e(e,i){t[e]=i}var t={};for(var i in this.fields){var n=this.fields[i];"function"==typeof n.getValue&&e(n.name,n.getValue()),n instanceof l&&n.elements.forEach(function(t){"function"==typeof t.getValue&&e(t.name,t.getValue())})}return t}}]),e}();i.SimpleSelect=d,i.TopSelect=f,i.Split=l,i.ToggleList=p,i.Form=h},{}],5:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t){n(this,e);var i=this;this.el=t.el,this.task_ids=t.task_ids,this.interval=null,this.refreshRate=t.refreshRate?t.refreshRate:1e3,this.debug=t.debug,this.request_pending=!1,this.onRender=t.onRender?t.onRender:function(){},this.stopIntervalling=1,this.curInterval=0,this.task_ids.length&&(this.interval=setInterval(function(){i._status(),i.curInterval+=1,i.debug&&i.curInterval==i.stopIntervalling&&i._clear()},this.refreshRate),i._status())}return a(e,[{
key:"_status",value:function(e){var t=this;this.request_pending||(this.request_pending=!0,this.setStatusText("Getting status..."),$.ajax({url:"/analysis/api/tasks/info/",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({task_ids:t.task_ids}),success:function(e){t._data(e),t.request_pending=!1},error:function(e){t._clear(),t.setStatusText("There was an error!")}}))}},{key:"_data",value:function(e){this.setStatusText("Done");var t=e.data;if(!(t instanceof Array)){var i=[];for(var n in e.data)i.push(e.data[n]);t=i.sort(function(e,t){return e.id>t.id})}t=t.map(function(e){return e.date_added=moment(e.added_on).format("DD/MM/YYYY"),e.time_added=moment(e.added_on).format("HH:mm"),e.is_ready="reported"==e.status,e}),this._draw(t)}},{key:"_draw",value:function(e){var t=HANDLEBARS_TEMPLATES["submission-task-table-body"];$(this.el).find("tbody").html(t({tasks:e})),this.onRender($(this.el))}},{key:"_clear",value:function(){this.interval&&clearInterval(this.interval),this.request_pending=!1}},{key:"setStatusText",value:function(e){$(this.el).find("tfoot .ajax-status").text(e)}}]),e}();i.SubmissionTaskTable=o},{}],6:[function(e,t,i){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}var a=e("./components/InterfaceControllers"),o=n(a),s=e("./components/FileTree"),r=n(s),l=e("./components/Analysis"),c=n(l),u=e("./components/SubmissionTaskTable"),d={machine:"default","network-routing":"internet",options:{"enforce-timeout":!1,"full-memory-dump":!1,"enable-injection":!0,"process-memory-dump":!0,"simulated-human-interaction":!0},package:null,priority:1,timeout:120,vpn:"united-states",available_vpns:[],available_machines:[]},f=[{name:"enable-injection",label:"Enable Injection",description:"Enable behavioral analysis."},{name:"process-memory-dump",label:"Process Memory Dump"},{name:"full-memory-dump",label:"Full Memory Dump",description:"If Volatility has been enabled, process an entire VM memory dump with it."},{name:"enforce-timeout",label:"Enforce Timeout"},{name:"simulated-human-interaction",label:"Enable Simulated Human Interaction",selected:!0}],p=["default","com","cpl","dll","doc","exe","generic","ie","ff","jar","js","hta","msi","pdf","ppt","ps1","pub","python","vbs","wsf","xls","zip"],h={};Handlebars.registerHelper("file_size",function(e){return new Handlebars.SafeString(r.humanizeBytes(parseInt(e)))}),$(function(){var e=window.location.toString().indexOf("#debugging")!==-1;if(e&&(console.debug("You run this module in debug mode. to disable it, remove #debugging from the url."),console.debug("Clicking analyze will output the JSON results to the console."),console.debug("Submitting is unavailable in this mode."),$(".flex-grid__footer").css("display","none")),null!==document.getElementById("analysis-configuration")){var t=new c.AnalysisInterface({container:document.getElementById("analysis-configuration"),filetree:{config:{label:"filetree",autoExpand:!0,sidebar:document.getElementById("filetree-detail"),nameKey:"filename",isDirectory:function(e){return"directory"===e.type||"container"===e.type}},load:{url:"/submit/api/filetree",method:"POST",params:{submit_id:window.submit_id},serialize:function(e){return e.defaults&&(d=e.defaults,h=d.routing,d.routing=h.route,d.available_vpns=h.vpns.map(function(e){return{name:e,value:e}}),d.available_machines=d.machine.map(function(e){return{name:e,value:e}}),d.available_machines.unshift({name:"default",value:null}),d.machine=d.available_machines[0].value),t.originalData=e.files,r.FileTree.iterateFileStructure(e.files,function(e){e.per_file_options=$.extend(new Object,d),e.changed_properties=[],e.package&&(e.per_file_options.package=e.package,p.indexOf(e.package)==-1&&p.push(e.package),e.changed_properties.push("package"));var t=r.FileTree.getParentContainerName(e);t&&(e.arcname=t.filename)}),p=p.map(function(e){return{name:e,value:e}}),e.files}},transform:{file:function(e,t){var i=this,n=$(e).find("div"),a=r.Label("size",r.humanizeBytes(this.size)),o=r.Label("info",'<i class="fa fa-info-circle"></i>',"a");if(n.append(o,a),this.duplicate){var s=r.Label("duplicate","duplicate file");n.append(s)}return $(o).on("click",function(e){e.stopImmediatePropagation(),t.detailView(i)}),this.filename=CuckooWeb.escapeHTML(this.filename),e},folder:function(e,t){var i,n,a=this,o=$(e).find("div"),s=r.Label("size",r.humanizeBytes(r.folderSize(this)));return"container"===this.type&&o.addClass("archive-container"),o.append(s),this.preview||(o.parent().addClass("skip-auto-expand"),i=r.Label("archive","Archive"),"directory"!==this.type&&(n=r.Label("info",'<i class="fa fa-info-circle"></i>',"a"),o.prepend(n),$(n).on("click",function(e){e.stopImmediatePropagation(),t.detailView(a)})),o.append(i)),e}},after:{selectionView:function(){},detailView:function(e,t){var i=this,n=$(e).find(".per-file-options")[0];if(n){var a;!function(){var e=function(e){var n=t(this.name);i.changed_properties.indexOf(n)==-1&&i.changed_properties.push(n),i.per_file_options[n]=e},t=function(e){var t=e.split("-");return t.splice(-1,1),t.join("-")};a=new o.Form({container:n,configure:function(t){var n=new this.TopSelect({name:"network-routing-"+i.filetree.index,title:"Network Routing",doc_link:"https://cuckoo.sh/docs/installation/host/routing.html",default:i.per_file_options["network-routing"],options:[{name:"none",value:"none",disabled:h.none===!1},{name:"drop",value:"drop",disabled:h.drop===!1},{name:"internet",value:"internet",disabled:h.internet===!1},{name:"inetsim",value:"inetsim",disabled:h.inetsim===!1},{name:"tor",value:"tor",disabled:h.tor===!1}],extra_select:{title:"VPN via",name:"vpn-"+i.filetree.index,default:i.per_file_options.vpn||void 0,disabled:h.vpn===!1||0===d.available_vpns.length,options:d.available_vpns}}).on("change",function(t){i.per_file_options["network-routing"]=t,e.call(this,t)}),a=new this.SimpleSelect({name:"package-"+i.filetree.index,title:"Package",doc_link:"https://cuckoo.sh/docs/usage/packages.html",default:i.per_file_options.package,options:p}).on("change",function(t){i.per_file_options.package=t,"default"==t&&(t=null),e.call(this,t)}),o=new this.TopSelect({name:"piority-"+i.filetree.index,title:"Priority",default:parseInt(i.per_file_options.priority),options:[{name:"low",value:1,className:"priority-s"},{name:"medium",value:2,className:"priority-m"},{name:"high",value:3,className:"priority-l"}]}).on("change",function(t){i.per_file_options.priority=t,e.call(this,parseInt(t))}),s=new this.TopSelect({name:"timeout-"+i.filetree.index,title:"Timeout",default:i.per_file_options.timeout,units:"seconds",options:[{name:"short",value:60,description:"60"},{name:"medium",value:120,description:"120"},{name:"long",value:300,description:"300"},{name:"custom",manual:!0}]}).on("change",function(t){i.per_file_options.timeout=t,e.call(this,t)}),r=new this.ToggleList({name:"options-"+i.filetree.index,title:"Options",extraOptions:!0,default:i.per_file_options.options,options:f,on:{init:function(){var e=[],t=this.options.map(function(e){return e.name});for(var i in this.default)t.indexOf(i)==-1&&e.push({key:i,value:this.default[i]});this.options_extra_predefined=e},change:function(t){i.per_file_options.options=t,e.call(this,t)}}}),l=new this.SimpleSelect({name:"machine-"+i.filetree.index,title:"Machine",default:i.per_file_options.machine,options:d.available_machines}).on("change",function(t){i.per_file_options.machine=t,e.call(this,t)});t.add([n,[a,o],s,r,l]),t.draw()}})}()}}}},form:{container:document.getElementById("submission-config"),configure:function(e){var i=new this.TopSelect({name:"network-routing",title:"Network Routing",default:d.routing,doc_link:"https://cuckoo.sh/docs/installation/host/routing.html",options:[{name:"none",value:"none",disabled:h.none===!1},{name:"drop",value:"drop",disabled:h.drop===!1},{name:"internet",value:"internet",disabled:h.internet===!1},{name:"inetsim",value:"inetsim",disabled:h.inetsim===!1},{name:"tor",value:"tor",disabled:h.tor===!1}],extra_select:{title:"VPN via",name:"vpn",disabled:h.vpn===!1||0===d.available_vpns.length,on:{change:function(){}},options:d.available_vpns}}),n=new this.SimpleSelect({name:"package",title:"Package",doc_link:"https://cuckoo.sh/docs/usage/packages.html",default:d.package,options:p}).on("change",function(e){t.filetree.each(function(t){t.per_file_options.package=e})}),a=new this.TopSelect({name:"priority",title:"Priority",default:d.priority,options:[{name:"low",value:1,className:"priority-s"},{name:"medium",value:2,className:"priority-m"},{name:"high",value:3,className:"priority-l"}]}),o=new this.ToggleList({name:"options",title:"Options",default:d.options,extraOptions:!0,options:f}),s=new this.SimpleSelect({name:"machine",title:"Machine",default:d.machine,options:d.available_machines}),r=new this.TopSelect({name:"timeout",title:"Timeout",default:d.timeout,units:"seconds",options:[{name:"short",value:60,description:"60"},{name:"medium",value:120,description:"120"},{name:"long",value:300,description:"300"},{name:"custom",manual:!0}]});e.add([i,[n,a],r,o,s]),e.draw(),e.on("change",function(e){function i(t){for(var i in e)t.changed_properties&&t.changed_properties.indexOf(i)==-1&&"package"!==i&&(t.per_file_options[i]=e[i])}if(t.filetree.each(function(e){i(e)}),t.filetree.detailViewActive){var n=t.filetree.activeIndex;t.filetree.detailView(t.filetree.getIndex(n))}})}},dndupload:{endpoint:"/submit/api/presubmit",target:"div#dndsubmit",template:HANDLEBARS_TEMPLATES.dndupload,success:function(e,t){$(t).removeClass("dropped"),$(t).addClass("done"),setTimeout(function(){window.location.href=e.responseURL},1e3)},error:function(e,t){$(t).addClass("error")},progress:function(e,t){e>50&&!$(t).hasClass("progress-half")&&$(t).addClass("progress-half"),$(this.options.target).find(".alternate-progress").css("transform","translateY("+(100-e)+"%)")},dragstart:function(e,t){t.classList.add("hover")},dragend:function(e,t){t.classList.remove("hover")},drop:function(e,t){t.classList.remove("hover"),t.classList.add("dropped")}}});$("#start-analysis").bind("click",function(i){i.preventDefault();var n=t.getData({submit_id:window.submit_id},!0);return JSON.parse(n).file_selection.length?(CuckooWeb.toggle_page_freeze(!0,"We're processing your submission... This could take a few seconds."),e?void console.log(JSON.parse(n)):void $.ajax({url:"/submit/api/submit",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:n,success:function(e){e.status===!0?window.location="/submit/post/"+e.submit_id:CuckooWeb.error_page_freeze("Something went wrong! please try again.")},error:function(){console.log(arguments),CuckooWeb.error_page_freeze("Something went wrong! please try again.")}})):void alert("Please select some files first.")}),$("#reset-options").bind("click",function(e){e.preventDefault()}),$(".upload-module .grouped-buttons a").on("shown.bs.tab",function(e){$(e.target).parent().find("a").removeClass("active"),$(this).addClass("active")}),$("input#urlhash").click(function(){var e=$("textarea#presubmit_urlhash").val();""!=e&&CuckooWeb.api_post("/submit/api/presubmit",{data:e,type:"strings"},function(e){CuckooWeb.redirect("/submit/pre/"+e.submit_id)},function(e){console.log("err: "+e)})})}if(null!==document.getElementById("submission-task-table")){new u.SubmissionTaskTable({el:document.getElementById("submission-task-table"),task_ids:task_ids,debug:!1,refreshRate:2500,onRender:function(e){e.find("tbody > tr.finished").bind("click",function(){var e=$(this).data("taskId");window.open("/analysis/"+e)})}})}})},{"./components/Analysis":1,"./components/FileTree":3,"./components/InterfaceControllers":4,"./components/SubmissionTaskTable":5}]},{},[6]);
//# sourceMappingURL=submission.js.map
